(()=>{"use strict";(()=>{function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function t(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?e(Object(i),!0).forEach((function(e){n(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t,n,r,i,s,a){try{var c=e[s](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,s){var a=e.apply(t,n);function c(e){r(a,i,s,c,u,"next",e)}function u(e){r(a,i,s,c,u,"throw",e)}c(void 0)}))}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.settings=null,this.eventsLib=window.eventsLib,this.params=window.ts_easy_integration_params,this.registerEvents()}var r,a,c,u,o,h,l,p,E,v,f,g,d,b,T,y,S,_,R,C,N,m,k,w,O,L;return r=e,a=[{key:"sendingNotification",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"save";console.log("Notification",e,t),this.eventsLib.dispatchAction({action:this.eventsLib.EVENTS.NOTIFICATION,payload:{event:e,status:t,type:n}})}},{key:"getLocaleCallback",value:function(){this.eventsLib.dispatchAction({action:this.eventsLib.EVENTS.SET_LOCALE,payload:this.params.locale})}},{key:"getInformationOfSystemCallback",value:function(){this.eventsLib.dispatchAction({action:this.eventsLib.EVENTS.SET_INFORMATION_OF_SYSTEAM,payload:{nameOfSystem:this.params.name_of_system,versionNumberOfSystem:this.params.version_of_system,versionNumberOfPlugin:this.params.version}})}},{key:"getCredentialsCallback",value:(L=i(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCredentials().then((function(e){t.eventsLib.dispatchAction({action:t.eventsLib.EVENTS.SET_CREDENTIALS_PROVIDED,payload:e})}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return L.apply(this,arguments)})},{key:"saveCredentialsCallback",value:(O=i(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getSettings().then((function(e){return e.client_id=t.payload.clientId,e.client_secret=t.payload.clientSecret,e})).then((function(e){return n.updateSettings(e)}));case 3:e.sent,this.sendingNotification(this.eventsLib.EVENTS.SAVE_CREDENTIALS,"success"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.sendingNotification(this.eventsLib.EVENTS.SAVE_CREDENTIALS,"error");case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e){return O.apply(this,arguments)})},{key:"getSalesChannelsCallback",value:function(){this.eventsLib.dispatchAction({action:this.eventsLib.EVENTS.SET_SALES_CHANNELS_PROVIDED,payload:this.params.sale_channels})}},{key:"getMappedChannelsCallback",value:(w=i(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChannels().then((function(e){t.eventsLib.dispatchAction({action:t.eventsLib.EVENTS.SET_MAPPED_CHANNELS,payload:e})}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"saveMappedChannelsCallback",value:(k=i(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getSettings().then((function(e){return e.channels=t.payload,e})).then((function(e){return n.updateSettings(e)}));case 3:return e.sent,e.next=6,this.getMappedChannelsCallback().then((function(){n.sendingNotification(n.eventsLib.EVENTS.SET_MAPPED_CHANNELS,"success")}));case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.sendingNotification(this.eventsLib.EVENTS.SET_MAPPED_CHANNELS,"error");case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return k.apply(this,arguments)})},{key:"disconnectCallback",value:(m=i(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.disconnect().then((function(e){t.eventsLib.dispatchAction({action:t.eventsLib.EVENTS.SET_DISCONNECTED,payload:null}),t.settings=null}));case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),this.sendingNotification(this.eventsLib.EVENTS.SET_DISCONNECTED,"error");case 8:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return m.apply(this,arguments)})},{key:"getUniqueId",value:function(e,t){return e+"_"+t}},{key:"getTrustbadgeCallback",value:(N=i(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTrustbadge(t.payload.salesChannelRef).then((function(e){n.eventsLib.dispatchAction({action:n.eventsLib.EVENTS.SET_TRUSTBADGE_CONFIGURATION_PROVIDED,payload:e||{id:"id",children:[]}})}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"saveTrustbadgeCallback",value:(C=i(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getSettings().then((function(e){return e.trustbadges[t.payload.salesChannelRef]=t.payload,e})).then((function(e){return n.updateSettings(e)}));case 3:return e.sent,e.next=6,this.getTrustbadgeCallback({payload:t.payload}).then((function(){n.sendingNotification(n.eventsLib.EVENTS.SAVE_TRUSTBADGE_CONFIGURATION,"success")}));case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.sendingNotification(this.eventsLib.EVENTS.SAVE_TRUSTBADGE_CONFIGURATION,"error");case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return C.apply(this,arguments)})},{key:"getWidgetsCallback",value:(R=i(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWidgets(t.payload.salesChannelRef).then((function(e){n.eventsLib.dispatchAction({action:n.eventsLib.EVENTS.SET_WIDGET_PROVIDED,payload:e})}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"getAdditionalWidgetLocationsCallback",value:function(){this.eventsLib.dispatchAction({action:this.eventsLib.EVENTS.SET_LOCATION_FOR_WIDGET,payload:this.params.widget_locations})}},{key:"saveWidgetsCallback",value:(_=i(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getSettings().then((function(e){return e.widgets[t.payload.salesChannelRef]=t.payload,e})).then((function(e){return n.updateSettings(e)}));case 3:return e.sent,e.next=6,this.getWidgetsCallback({payload:t.payload}).then((function(){n.sendingNotification(n.eventsLib.EVENTS.SAVE_WIDGET_CHANGES,"success")}));case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.sendingNotification(this.eventsLib.EVENTS.SAVE_WIDGET_CHANGES,"error");case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return _.apply(this,arguments)})},{key:"getHasReviewInvitesCallback",value:(S=i(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChannelById(t.payload.salesChannelRef).then((function(e){e?n.hasEnabledReviewInvites(t.payload.salesChannelRef).then((function(t){n.eventsLib.dispatchAction({action:n.eventsLib.EVENTS.SET_PRODUCT_REVIEW_FOR_CHANNEL,payload:t?e:null})})):n.eventsLib.dispatchAction({action:n.eventsLib.EVENTS.SET_PRODUCT_REVIEW_FOR_CHANNEL,payload:null})}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"updateReviewInvitesCallback",value:(y=i(regeneratorRuntime.mark((function e(t){var n,r,i=this,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]&&s[1],r=n?this.eventsLib.EVENTS.ACTIVATE_PRODUCT_REVIEW_FOR_CHANNEL:this.eventsLib.EVENTS.DEACTIVATE_PRODUCT_REVIEW_FOR_CHANNEL,e.prev=2,e.next=5,this.getSettings().then((function(e){return n&&!e.enable_invites.includes(t.salesChannelRef)?e.enable_invites.push(t.salesChannelRef):!n&&e.enable_invites.includes(t.salesChannelRef)&&(e.enable_invites=e.enable_invites.filter((function(e){return e!==t.salesChannelRef}))),console.log(e.enable_invites),e})).then((function(e){return i.updateSettings(e)}));case 5:return e.sent,e.next=8,this.getHasReviewInvitesCallback({payload:{id:t.eTrustedChannelRef,salesChannelRef:t.salesChannelRef}}).then((function(){i.sendingNotification(r,"success")}));case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),this.sendingNotification(r,"error");case 13:case"end":return e.stop()}}),e,this,[[2,10]])}))),function(e){return y.apply(this,arguments)})},{key:"activateReviewInvitesCallback",value:(T=i(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateReviewInvitesCallback(t.payload,!0);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"deactivateReviewInvitesCallback",value:(b=i(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateReviewInvitesCallback(t.payload,!1);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"registerEvents",value:(d=i(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.eventsLib.registerEvents((n(t={},this.eventsLib.EVENTS.GET_INFORMATION_OF_SYSTEAM,this.getInformationOfSystemCallback.bind(this)),n(t,this.eventsLib.EVENTS.GET_LOCALE,this.getLocaleCallback.bind(this)),n(t,this.eventsLib.EVENTS.SAVE_CREDENTIALS,this.saveCredentialsCallback.bind(this)),n(t,this.eventsLib.EVENTS.GET_CREDENTIALS_PROVIDED,this.getCredentialsCallback.bind(this)),n(t,this.eventsLib.EVENTS.GET_SALES_CHANNELS_PROVIDED,this.getSalesChannelsCallback.bind(this)),n(t,this.eventsLib.EVENTS.GET_MAPPED_CHANNELS,this.getMappedChannelsCallback.bind(this)),n(t,this.eventsLib.EVENTS.SAVE_MAPPED_CHANNEL,this.saveMappedChannelsCallback.bind(this)),n(t,this.eventsLib.EVENTS.DISCONNECTED,this.disconnectCallback.bind(this)),n(t,this.eventsLib.EVENTS.GET_TRUSTBADGE_CONFIGURATION_PROVIDED,this.getTrustbadgeCallback.bind(this)),n(t,this.eventsLib.EVENTS.SAVE_TRUSTBADGE_CONFIGURATION,this.saveTrustbadgeCallback.bind(this)),n(t,this.eventsLib.EVENTS.GET_LOCATION_FOR_WIDGET,this.getAdditionalWidgetLocationsCallback.bind(this)),n(t,this.eventsLib.EVENTS.GET_WIDGET_PROVIDED,this.getWidgetsCallback.bind(this)),n(t,this.eventsLib.EVENTS.SAVE_WIDGET_CHANGES,this.saveWidgetsCallback.bind(this)),n(t,this.eventsLib.EVENTS.GET_PRODUCT_REVIEW_FOR_CHANNEL,this.getHasReviewInvitesCallback.bind(this)),n(t,this.eventsLib.EVENTS.ACTIVATE_PRODUCT_REVIEW_FOR_CHANNEL,this.activateReviewInvitesCallback.bind(this)),n(t,this.eventsLib.EVENTS.DEACTIVATE_PRODUCT_REVIEW_FOR_CHANNEL,this.deactivateReviewInvitesCallback.bind(this)),n(t,this.eventsLib.EVENTS.EXPORT_PREVIOUS_ORDER,(function(e){console.log("DEMO:EXPORT_PREVIOUS_ORDER",e.payload)})),t));case 1:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"getAjaxUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e+"_nonce"in this.params?this.params[e+"_nonce"]:t;return e="ts_easy_integration_"+e,this.params.ajax_url+"?action="+e+"&security="+n}},{key:"getSettings",value:(g=i(regeneratorRuntime.mark((function e(){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.settings){e.next=13;break}return e.next=3,fetch(this.getAjaxUrl("get_settings"),{headers:{"Content-Type":"application/json;charset=UTF-8"},method:"POST",body:JSON.stringify({})}).catch((function(){throw new TypeError("Error message")}));case 3:return n=e.sent,e.next=6,n.json().then((function(e){return e.settings})).catch((function(){throw new TypeError("Error message")}));case 6:this.settings=e.sent,r=n.headers.get("Client-Id"),i=n.headers.get("Client-Secret"),this.settings.client_id=null!==r?atob(r):"",this.settings.client_secret=null!==i?atob(i):"",this.settings.trustbadges=t({},this.settings.trustbadges),this.settings.widgets=t({},this.settings.widgets);case 13:if(this.settings){e.next=15;break}throw new TypeError("Error message");case 15:return e.abrupt("return",this.settings);case 16:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"updateSettingsData",value:function(e){var t=this.settings?this.settings.client_id:"",n=this.settings?this.settings.client_secret:"",r=e;return r.client_id=t,r.client_secret=n,r}},{key:"disconnect",value:(f=i(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.getAjaxUrl("disconnect"),{headers:{"Content-Type":"application/json;charset=UTF-8"},method:"POST",body:JSON.stringify({})}).then((function(e){return e.json()})).then((function(e){if(!e.success)throw new TypeError(e.message);return!0})).catch((function(){throw new TypeError("Error while updating settings.")}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"updateSettings",value:(v=i(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.getAjaxUrl("update_settings"),{headers:{"Content-Type":"application/json;charset=UTF-8"},method:"POST",body:JSON.stringify(t)}).then((function(e){return e.json()})).then((function(e){if(!e.success)throw new TypeError(e.message);return n.updateSettingsData(e.settings)})).catch((function(){throw new TypeError("Error while updating settings.")}));case 2:if(this.settings=e.sent,this.settings){e.next=5;break}throw new TypeError("Error while updating settings.");case 5:return e.abrupt("return",this.settings);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"getCredentials",value:(E=i(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={clientId:"",clientSecret:""},e.prev=1,e.next=4,this.getSettings().then((function(e){return{clientId:e.client_id,clientSecret:e.client_secret}}));case 4:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",t);case 10:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(){return E.apply(this,arguments)})},{key:"getChannels",value:(p=i(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getSettings().then((function(e){return e.channels}));case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",[]);case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return p.apply(this,arguments)})},{key:"getChannelById",value:(l=i(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getSettings().then((function(e){return e.channels.filter((function(e){return e.salesChannelRef===t}))[0]}));case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return l.apply(this,arguments)})},{key:"getTrustbadge",value:(h=i(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getSettings().then((function(e){return e.trustbadges.hasOwnProperty(t)?e.trustbadges[t]:null}));case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return h.apply(this,arguments)})},{key:"getWidgets",value:(o=i(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getSettings().then((function(e){return e.widgets.hasOwnProperty(t)?e.widgets[t]:null}));case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return o.apply(this,arguments)})},{key:"hasEnabledReviewInvites",value:(u=i(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getSettings().then((function(e){return e.enable_invites.includes(t)}));case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return u.apply(this,arguments)})}],c=[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}],a&&s(r.prototype,a),c&&s(r,c),Object.defineProperty(r,"prototype",{writable:!1}),e})().Instance})()})();